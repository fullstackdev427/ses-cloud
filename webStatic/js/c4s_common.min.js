window.c4s={hdlClickGnaviBtn:function(e,n){var t,r=$("<form/>")[0],i=$("<input type='hidden' name='json'/>")[0],a={login_id:env.login_id,credential:env.credential};if("matching.project"!=e&&"matching.engineer"!=e||c4s.loadSearchConditionFromCookie(a,e),n)for(t in n)a[t]=n[t];r.appendChild(i),r.action="/"+[env.prefix,"html",e].join("/")+"/",r.method="POST",r.enctype="application/x-www-form-urlencoded",i.value=JSON.stringify(a),$("body").append(r),r.submit()},hdlClickClearInvoiceBtn:function(e,n){var t,r=$("<form/>")[0],i=$("<input type='hidden' name='json'/>")[0],a={login_id:env.login_id,credential:env.credential,check_init:1};if(n)for(t in n)a[t]=n[t];r.appendChild(i),r.action="/"+[env.prefix,"html",e].join("/")+"/",r.method="POST",r.enctype="application/x-www-form-urlencoded",i.value=JSON.stringify(a),$("body").append(r),r.submit()},hdlClickSearchBtn:function(){var e=genFilterQuery();genOrderQuery(e),e.login_id=env.login_id,c4s.invokeApi_ex({location:env.current,body:e,pageMove:!0})},hdlClickDirectionBtn:function(e,n){var t=$("<form/>")[0],r=$("<input type='hidden' name='json'/>")[0],i={login_id:env.login_id,credential:env.credential};t.appendChild(r),t.action="/"+[env.prefix,"html",e].join("/")+"/",t.method="POST",t.enctype="application/x-www-form-urlencoded",n||(t.target="_blank"),r.value=JSON.stringify(i),$("body").append(t),t.submit()},hdlClickVideoBtn:function(e){c4s.invokeApi_ex({location:"home.video",body:{video:e},pageMove:!0,newPage:!0})},openMap:function(e){var n=!!e&&(e.addr1||e.addr2||""),t=!!e&&!e.isFloodLMT;t&&n?c4s.invokeApi_ex({location:"client.mapClient",body:e,pageMove:!0,newPage:!0}):!1===t?alert("月間利用可能回数の上限を超えています。詳細は担当者にご確認下さい"):alert("住所を入力してください")},invokeApi:function(e,n,t,r,i){if(r=r||!1,i=i||!1,n.login_id=env.login_id,n.credential=env.credential||env.cookie_cred,env.debugOut(n),r){var a=$("<form/>")[0],m=$("<input type='hidden' name='json'/>")[0];a.appendChild(m),a.action="/"+env.prefix+"/html/"+e+"/",a.method="POST",a.enctype="application/x-www-form-urlencoded",i&&(a.target="_blank"),m.value=JSON.stringify(n),$("body").append(a),a.submit()}else{var o={async:!1,contentType:"application/json",cache:!1,dataType:"json",processData:!1};o.url=e,o.timeout=3,o.type="POST",o.url="/"+env.prefix+"/api/"+e+"/json",o.success=function(e,n){env.debugOut(e),t(e)},o.data=JSON.stringify(n),$.ajax(o)}},validate:function(e,n,t){c4s.clearValidate(t);var r,i,a,m,o,g={r_type:function(e,n){return typeof e==typeof n()||e instanceof n},r_typeOrNull:function(e,n){return null==e||typeof e==typeof n()||e instanceof n},r_bool:function(e,n){return Boolean(e)===n},r_minLength:function(e,n){try{return e.length>=n}catch(e){return!1}},r_maxLength:function(e,n){try{return e.length<=n}catch(e){return!1}},r_length:function(e,n){return e.length==n},r_minNum:function(e,n){return e>=n},r_maxNum:function(e,n){return e<=n},r_candidate:function(e,n){return n instanceof Array&&1==n.filter(function(n){return e==n}).length},r_regex:function(e,n){return"string"==typeof n&&Boolean(e.match(new RegExp(n)))}},p=[];for(r in e)if(i=n[r],i)for(a in a=null,i)"msg"!==a&&(m=g["r_"+a](e[r],i[a]),m||(p.push(i.msg?i.msg:r+":"+a),t&&t[r]&&(o="string"==typeof t[r]?$(0==t[r].indexOf("#")?t[r]:"#"+t[r]):t[r],o.parent().removeClass("has-error"),o.parent().addClass("has-error"))));return p},clearValidate:function(e){var n,t;if(e)for(n in e)t="string"==typeof e[n]?$(0==e[n].indexOf("#")?e[n]:"#"+e[n]):e[n],t.parent().removeClass("has-error")},validateRules:{client:{id:{type:Number,minNum:1},name:{type:String,minLength:1,maxLength:64},kana:{type:String,minLength:1,maxLength:128},addr_vip:{type:String,maxLength:7,regex:"^([0-9]{3}-?[0-9]{4})?$"},addr1:{type:String,minLength:1,maxLength:64},addr2:{type:String,maxLength:64},tel:{type:String,maxLength:15,regex:"^([\\(\\)0-9]+-?[0-9-]+)?$"},fax:{type:String,maxLength:15,regex:"^([\\(\\)0-9]+-?[0-9-]+)?$"},site:{type:String,maxLength:128,regex:"^((http|https)\\://.+)?$"},type_dealing:{type:String},type_presentation:{type:Array,minLength:1},note:{type:String}},branch:{id:{type:Number,minNum:1},name:{type:String,minLength:1,maxLength:32},client_id:{type:Number,minNum:1},addr_vip:{type:String,maxLength:7,regex:"^([0-9]{3}-?[0-9]{4})?$"},addr1:{type:String,minLength:1,maxLength:64},addr2:{type:String,maxLength:64},tel:{type:String,maxLength:15,regex:"^([\\(\\)0-9]+-?[0-9-]+)?$"},fax:{type:String,maxLength:15,regex:"^([\\(\\)0-9]+-?[0-9-]+)?$"}},worker:{id:{type:Number,minNum:1},client_id:{type:Number,minNum:1},name:{type:String,minLength:1,maxLength:32},kana:{type:String,minLength:1,maxLength:64},section:{type:String,maxLength:64},title:{type:String,maxLength:32},tel:{type:String,maxLength:15,regex:"^([\\(\\)0-9]+-?[0-9-]+)?$"},tel2:{type:String,maxLength:15,regex:"^([\\(\\)0-9]+-?[0-9-]+)?$"},mail1:{type:String,maxLength:64,regex:"^([0-9a-zA-Z_.\\-+]+@[0-9a-zA-Z_.\\-+]+)?$"},mail2:{type:String,maxLength:64,regex:"^([0-9a-zA-Z_.\\-+]+@[0-9a-zA-Z_.\\-+]+)?$"},flg_keyperson:{type:Boolean},flg_sendmail:{type:Boolean},recipient_priority:{type:Number,minNum:1,maxNum:9}},project:{id:{type:Number,minNum:1},client_id:{type:Number,minNum:1},client_name:{type:String,minLength:1,maxLength:32},title:{type:String,minLength:1,maxLength:64},term:{type:String,maxLength:32},term_begin:{type:Date,maxLength:10},term_end:{type:Date,maxLength:10},age_from:{type:Number,minNum:18},age_to:{type:Number,minNum:18},fee_inbound:{type:Number,minNum:0},fee_outbound:{type:Number,minNum:0},expense:{type:String,maxLength:64},process:{type:String,maxLength:128},interview:{type:Number,minNum:0,maxNum:99},station:{type:String,maxLength:15},scheme:{type:String,candidate:["元請","エンド",""]},skill_needs:{type:String,maxLength:512},skill_recommends:{type:String,maxLength:512}},engineer:{id:{type:Number,minNum:1},client_id:{type:Number,minNum:1},name:{type:String,minLength:1,maxLength:32},kana:{type:String,minLength:1,maxLength:64},visible_name:{type:String,minLength:1,maxLength:16},tel:{type:String,maxLength:15,regex:"^([\\(\\)0-9]+-?[0-9-]+)?$"},mail1:{type:String,maxLength:64,regex:"^([0-9a-zA-Z_.\\-+]+@[0-9a-zA-Z_.\\-+]+)?$"},mail2:{type:String,maxLength:64,regex:"^([0-9a-zA-Z_.\\-+]+@[0-9a-zA-Z_.\\-+]+)?$"},birth:{type:String,maxLength:10},age:{type:Number,maxNum:99},gender:{type:String,length:1},fee:{type:Number,minNum:0},station:{type:String,maxLength:15},skill:{type:String,maxLength:512},state_work:{type:String,maxLength:8},employer:{type:String,maxLength:100},operation_begin:{type:String,maxLength:10},addr_vip:{type:String,maxLength:7,regex:"^([0-9]{3}-?[0-9]{4})?$"},addr1:{type:String,maxLength:64},addr2:{type:String,maxLength:64}},preparation:{client_name:{type:String,minLength:1,maxLength:32},time:{type:String,maxLength:32},progress:{type:String,maxLength:64},note:{type:String,maxLength:128}},negotiation:{id:{type:Number,minNum:1},name:{type:String,minLength:1,maxLength:64},client_name:{type:String,minLength:1,maxLength:32},note:{type:String}},schedule:{},todo:{id:{type:Number,minNum:1},note:{type:String,minLength:1,maxLength:128}},mailRequest:{tpl_id:{type:Number,minNum:1},addr_to:{type:Array,minLength:1},addr_cc:{type:Array},addr_bcc:{type:Array},subject:{type:String,minLength:1,maxLength:64},body:{type:String,minLength:1},attachments:{type:Array}},account:{new_login_id:{type:String,minLength:1,maxLength:32},name:{type:String,minLength:1,maxLength:32},tel1:{type:String,minLength:1,maxLength:15,regex:"^([\\(\\)0-9]+-?[0-9-]+)?$"},mail1:{type:String,minLength:3,maxLength:64,regex:"^([0-9a-zA-Z_.\\-+]+@[0-9a-zA-Z_.\\-+]+)?$"},password:{type:String,minLength:5}},mailAddr:{mail:{type:String,minLength:3,maxLength:64,regex:"^([0-9a-zA-Z_.\\-+]+@[0-9a-zA-Z_.\\-+]+)?$"}},signupCompany:{name:{type:String,minLength:1,maxLength:32},owner_name:{type:String,minLength:1,maxLength:32},tel:{type:String,minLength:1,maxLength:15,regex:"^([\\(\\)0-9]+-?[0-9-]+)$"},fax:{type:String,minLength:0,maxLength:15,regex:"^([\\(\\)0-9]+-?[0-9-]+)?$"},addr_vip:{type:String,maxLength:8,regex:"^([0-9]{3}-?[0-9]{4})$"},addr1:{type:String,minLength:1,maxLength:64},addr2:{type:String,maxLength:64},prefix:{type:String,maxLength:8,regex:"^([0-9a-zA-Z_.\\-+]+)?$"}},signupUser:{name:{type:String,minLength:1,maxLength:32},prefer_login_id:{type:String,minLength:1,maxLength:32},pwd:{type:String,minLength:5},mail1:{type:String,minLength:3,maxLength:64,regex:"^([0-9a-zA-Z_.\\-+]+@[0-9a-zA-Z_.\\-+]+)+$"},tel1:{type:String,minLength:1,maxLength:15,regex:"^([\\(\\)0-9]+-?[0-9-]+)+$"},tel2:{type:String,minLength:0,maxLength:15,regex:"^([\\(\\)0-9]+-?[0-9-]+)?$"},fax:{type:String,minLength:0,maxLength:15,regex:"^([\\(\\)0-9]+-?[0-9-]+)?$"}},updatePref:{max_account:{type:Number,minNum:0,maxNum:9999},max_client:{type:Number,minNum:0,maxNum:9999},max_worker:{type:Number,minNum:0,maxNum:9999},max_project:{type:Number,minNum:0,maxNum:9999},max_engineer:{type:Number,minNum:0,maxNum:9999},max_mail_tpl:{type:Number,minNum:0,maxNum:9999}},operation:{project_client_id:{type:Number,minNum:1},project_name:{type:String,minLength:1,maxLength:64},engineer_name:{type:String,minLength:1,maxLength:32},term_memo:{type:String,minLength:0,maxLength:64},is_active:{type:Number,minNum:0},is_fixed:{type:Number,minNum:0},transfer_member:{type:String,minLength:0,maxLength:32},demand_site:{type:String,minLength:0,maxLength:64},payment_site:{type:String,minLength:0,maxLength:64},other_memo:{type:String,minLength:0,maxLength:64},base_exc_tax:{type:Number,minNum:0,maxNum:999999999},demand_wage_per_hour:{type:Number,minNum:0,maxNum:999999999},demand_working_time:{typeOrNull:Number,minNum:0,maxNum:9999},settlement_from:{typeOrNull:Number,minNum:0,maxNum:9999},settlement_to:{typeOrNull:Number,minNum:0,maxNum:9999},deduction:{type:Number,minNum:0,maxNum:999999999},excess:{type:Number,minNum:0,maxNum:999999999},payment_base:{type:Number,minNum:0,maxNum:999999999},payment_wage_per_hour:{type:Number,minNum:0,maxNum:999999999},payment_working_time:{typeOrNull:Number,minNum:0,maxNum:9999},payment_settlement_from:{typeOrNull:Number,minNum:0,maxNum:9999},payment_settlement_to:{typeOrNull:Number,minNum:0,maxNum:9999},payment_deduction:{type:Number,minNum:0,maxNum:999999999},payment_excess:{type:Number,minNum:0,maxNum:999999999},welfare_fee:{type:Number,minNum:0,maxNum:999999999},transportation_fee:{type:Number,minNum:0,maxNum:999999999},bonuses_division:{type:Number,minNum:0,maxNum:999999999},engineer_client_id:{type:Number,minNum:1}}},genValidateMessage:function(e,n){var t,r,i,a,m={client:{name:"取引先名",kana:"取引先名（カナ）",addr_vip:"郵便番号",addr1:"住所1",addr2:"住所2",tel:"電話番号",fax:"FAX番号",site:"ホームページ"},mailRequest:{addr_to:"宛先",addr_cc:"CC",addr_bcc:"BCC",subject:"件名"},signupCompany:{name:"企業・団体名",owner_name:"代表者名",tel:"代表電話番号",fax:"代表FAX番号",addr_vip:"郵便番号",addr1:"住所",addr2:"住所（ビル名/部屋番号など）"},signupUser:{name:"氏名",login_id:"ログインID",pwd:"パスワード",mail1:"メール アドレス",tel1:"電話番号（メイン）",tel2:"電話番号（サブ）",fax:"FAX番号"},updatePref:{max_account:"ユーザー アカウント数上限",max_client:"取引先登録数上限",max_worker:"取引先担当者登録数上限",max_project:"案件登録数上限",max_engineer:"要員登録数上限",max_mail_tpl:"メール テンプレート数上限"}},o={defaults:{minNum:"の最小値が範囲外です",maxNum:"の最大値が範囲外です",minLength:"が短かすぎます",maxLength:"が長すぎます",regex:"が正しい形式ではありません",candidate:"が候補外です"}},g=[];for(t=0;t<e.length;t++)r=e[t].split(":"),2==r.length?(i=r[0],a=r[1],m[n]&&m[n][i]&&(o.defaults[a]||o[n][a]?g.push("「"+m[n][i]+"」"+(o.defaults[a]||o[n][a])):g.push("「"+m[n][i]+"」が正しくありません"))):0==g.length&&g.push("入力を修正してください");return g},invokeApi_ex:function(e){var n=e.body.delay?e.body.delay:null;if(e.body?(e.body.login_id=env.login_id,e.body.credential=env.credential):e.body={login_id:env.login_id,credential:env.credential},env.debugOut(e),e.body)if(e.pageMove){var t=$("<form/>")[0],r=$("<input type='hidden' name='json'/>")[0];t.appendChild(r),t.action="/"+env.prefix+"/html/"+e.location+"/",t.method="POST",t.enctype="application/x-www-form-urlencoded",e.newPage&&(t.target="_blank"),r.value=JSON.stringify(e.body),$("body").append(t),e.location&&t.submit()}else{var i={};i.async=e.async||!1,i.contentType="application/json",i.cache=!1,i.dataType="json",i.processData=!1,i.timeout=e.timeout||3,i.type="POST",i.url="/"+env.prefix+"/api/"+e.location+"/json",i.success=function(n,t){env.debugOut(n),n&&n.status&&0==n.status.code?(e.onSuccess?e.onSuccess:env.debugOut)(n):n&&n.status&&15==n.status.code&&n.status.signature.length?c4s.showAlertCapacity(n.status.signature[0]):(e.onError?e.onError:env.debugOut)(n)},i.data=JSON.stringify(e.body),n?setTimeout(function(e){return function(){$.ajax(e)}}(i),n):$.ajax(i)}else env.debugOut("option.body must be set.")},searchAll:function(e){return c4s.invokeApi_ex({location:"home.search",body:{word:e},pageMove:!0}),!1},reloadWithOrder:function(e,n){var t=env.recentQuery||{};delete t.pageOffset,delete t.ctrl_referer,delete t.modal,delete t.sort_keys,t.sort_keys={},n&&(t.sort_keys[e]=n),c4s.invokeApi_ex({location:env.current,body:t,pageMove:!0})},hdlClickDeleteItem:function(e,n,t,r){if(n&&!(n instanceof Array&&0==n.length)){var i,a={id_list:n instanceof Array?n:[n]};switch(e){case"client":i="client.deleteClient";break;case"branch":i="client.deleteBranch";break;case"contact":i="client.deleteContact";break;case"worker":case"worker_sm":i="client.deleteWorker";break;case"project":i="project.deleteProject";break;case"engineer":i="engineer.deleteEngineer";break;case"preparation":i="engineer.deletePreparation";break;case"negotiation":i="negotiation.deleteNegotiation";break;case"schedule":i="misc.deleteSchedule";break;case"todo":i="misc.deleteTodo";break;case"template":i="mail.deleteTemplate";break;case"account":i="manage.deleteAccount";break;default:i="manage.env"}return confirm("削除してよろしいですか？")?(c4s.invokeApi_ex({location:i,body:a,onSuccess:function(n){var i;if(env.recentAjaxResult=n,n&&n.data.rows&&n.data.rows>0)if(t)for(i=0;i<a.id_list.length;i++){var m=$("#iter_"+e+"_"+a.id_list[i]),o=m.parent("tbody");m.fadeOut(env.TRANS_SPEED_DELETE,function(){m.remove(),0==o.children("tr").length&&o.append("<tr><td colspan='"+o.prev().children("tr").children("th").length+"'>有効なデータがありません</td></tr>")})}else r?r():c4s.invokeApi_ex({location:env.current,body:env.recentQuery,pageMove:!0})}}),!0):void 0}alert("対象データを選択してください。")},jumpToPagination:function(e){c4s.jumpToPage(env.current,{pageNumber:e,query:genFilterQuery()})},jumpToPage:function(e,n){n=n||{};var t=n.query||{};n.tab&&(t.ctrl_selectedTab=n.tab),t.ctrl_referer={path:env.current,tab:env.currentTab||n.currentTab||null,modal:env.currentModal||n.currentModal||null,query:env.recentQuery},t.ctrl_referer.query&&t.ctrl_referer.query.login_id&&delete t.ctrl_referer.query.login_id,t.ctrl_referer.query&&t.ctrl_referer.query.credential&&delete t.ctrl_referer.query.credential,t.ctrl_referer.query&&t.ctrl_referer.query.ctrl_referer&&delete t.ctrl_referer.query.ctrl_referer,n.pageNumber?t.pageNumber=n.pageNumber:t.pageNumber=1,n.modal&&(t.ctrl_referer.modal=n.modal),c4s.invokeApi_ex({location:e,body:t,pageMove:!0})},hdlCloseModal:function(e){var n,t=$(e.currentTarget).data("commitCompleted"),r=!1,i={};if(env.recentQuery&&env.recentQuery.ctrl_referer&&env.recentQuery.ctrl_referer.query)for(n in env.recentQuery.ctrl_referer.query)"ctrl_referer"!==n&&(i[n]=env.recentQuery.ctrl_referer.query[n]);t&&r?c4s.jumpToPage(env.recentQuery.ctrl_referer.path,{query:i}):t&&!r?c4s.jumpToPage(env.current,{query:env.recentQuery}):!t&&r&&c4s.jumpToPage(env.recentQuery.ctrl_referer.path,{query:i})},hdlClickNewObjBtn:function(e){var n,t={};switch(e){case"engineer":n="engineer.top",t.query={modal:"createEngineer"};break;case"project":n="project.top",t.query={modal:"createProject"};break;default:n="home.enum"}c4s.jumpToPage(n,t)},hdlClickViewObjText:function(e,n){var t,r={};switch(e){case"engineer":t="engineer.top",r.query={modal:"editEngineer",id:n};break;case"project":t="project.top",r.query={modal:"editProject",id:n};break;case"client":t="client.clientTop",r.query={modal:"editClient",id:n};break;default:t="home.enum"}c4s.jumpToPage(t,r)},toggleSelectAll:function(e,n){$("input[id^="+e+"]").each(function(e,t){t.checked=n.checked})},download:function(e){var n=$("<form enctype='application/json' encoding='application/json'></form>")[0];n.action="/"+env.prefix+"/api/file.download/json",n.method="POST";var t=$("<input type='hidden' name='json'/>")[0];t.value=JSON.stringify({login_id:env.login_id,credential:env.credential,id:e}),n.appendChild(t),$(n).css("position","fixed"),$(n).css("top","0px"),$(n).css("left","0ox"),$(n).css("width","1px"),$(n).css("height","1px"),document.body.appendChild(n),n.submit()},downloadAll:function(e){var n=$("<form enctype='application/json' encoding='application/json'></form>")[0];n.action="/"+env.prefix+"/api/file.downloadAll/json",n.method="POST";var t=$("<input type='hidden' name='json'/>")[0];t.value=JSON.stringify({login_id:env.login_id,credential:env.credential,id:e}),n.appendChild(t),$(n).css("position","fixed"),$(n).css("top","0px"),$(n).css("left","0ox"),$(n).css("width","1px"),$(n).css("height","1px"),document.body.appendChild(n),n.submit()},setCookies:function(e,n){var t=new Date;t.setTime(t.getTime()+31536e8),document.cookie=e+"="+encodeURIComponent(n)+"; expires="+t.toUTCString()+";path=/"},getCookies:function(){for(var e=new Array,n=document.cookie,t=n.split("; "),r=0;r<t.length;r++){var i=t[r].split("=");e[i[0]]=decodeURIComponent(i[1])}return e},deleteCookie:function(e){var n=new Date;n.setTime(n.getTime()-1),document.cookie=e+"=; expires="+n.toUTCString()},loadSearchConditionFromCookie:function(e,n){var t=c4s.getCookies(),r=env.companyInfo.id,i=env.userInfo.id;if("matching.project"==n){var a=t["projectBlackCompanyId"+r+i];null!=a&&""!=a&&(e.not_company_id=a.split(","))}"matching.engineer"==n&&(a=t["engineerBlackCompanyId"+r+i],null!=a&&""!=a&&(e.not_company_id=a.split(",")))},calcIncTax:function(e){var n=.1;return Math.round(e*(1+n))},calcExcTax:function(e){var n=.1;return Math.round(e/(1+n))},floor:function(e,n){return Math.floor(e*Math.pow(10,n))/Math.pow(10,n)},sleep:function(e){for(var n=new Date;;){var t=new Date;if(t-n>e)break}}};