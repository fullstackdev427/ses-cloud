(function(){var t,e;e=Function("return this")(),t=function(){function t(t,e){var n;t.match(/^#/)||(t="#"+t),e.match(/^#/)||(e="#"+e),this.elName=$(t),this.elKana=$(e),n={build:!0,katakana:!1},this.options=$.extend(n,arguments[2]||{}),this.active=!0,this._stateClear(),this._build()}return t.prototype.kana_extraction_pattern=new RegExp("[^ 　ぁあ-んー]","g"),t.prototype.kana_compacting_pattern=new RegExp("[ぁぃぅぇぉっゃゅょ]","g"),t.prototype.start=function(){this.active=!0},t.prototype.stop=function(){this.active=!1},t.prototype.toggle=function(t){var e;t||window.event,t?(e=Event.element(t),e.checked?this.active=!0:this.active=!1):this.active=!this.active},t.prototype._addEvents=function(){var t=this;this.elName.on("blur",function(){return t._eventBlur(t)}),this.elName.on("focus",function(){return t._eventFocus(t)}),this.elName.on("keydown",function(){return t._eventKeyDown(t)})},t.prototype._build=function(){this.options.build&&this._addEvents()},t.prototype._checkConvert=function(t){var e;this.flagConvert||(Math.abs(this.values.length-t.length)>1?(e=t.join("").replace(this.kana_compacting_pattern,"").split(""),Math.abs(this.values.length-e.length)>1&&this._stateConvert()):this.values.length===this.input.length&&this.values.join("")!==this.input&&this._stateConvert())},t.prototype._checkValue=function(){var t,e;if(t=this.elName.val(),""===t)this._stateClear(),this._setKana();else{if(t=this._removeString(t),this.input===t)return;this.input=t,this.flagConvert||(e=t.replace(this.kana_extraction_pattern,"").split(""),this._checkConvert(e),this._setKana(e))}},t.prototype._clearInterval=function(){clearInterval(this.timer)},t.prototype._eventBlur=function(t){t._clearInterval()},t.prototype._eventFocus=function(t){t._stateInput(),t._setInterval()},t.prototype._eventKeyDown=function(t){t.flagConvert&&t._stateInput()},t.prototype._isHiragana=function(t){return t>=12353&&t<=12435||12445===t||12446===t},t.prototype._removeString=function(t){var e,n,i,a,o;if(t.match(this.ignoreString))return t.replace(this.ignoreString,"");for(n=this.ignoreString.split(""),i=t.split(""),e=a=0,o=n.length-1;0<=o?a<=o:a>=o;e=0<=o?++a:--a)n[e]===i[e]&&(i[e]="");return i.join("")},t.prototype._setInterval=function(){var t=this;this.timer=setInterval(function(){return t._checkValue()},30)},t.prototype._setKana=function(t){this.flagConvert||(t&&(this.values=t),this.active&&this.elKana.val(this._toKatakana(this.baseKana+this.values.join(""))))},t.prototype._stateClear=function(){this.baseKana="",this.flagConvert=!1,this.ignoreString="",this.input="",this.values=[]},t.prototype._stateInput=function(){this.baseKana=this.elKana.val(),this.flagConvert=!1,this.ignoreString=this.elName.val()},t.prototype._stateConvert=function(){this.baseKana=this.baseKana+this.values.join(""),this.flagConvert=!0,this.values=[]},t.prototype._toKatakana=function(t){var e,n,i,a,o;if(this.options.katakana){for(i=new String,n=a=0,o=t.length-1;0<=o?a<=o:a>=o;n=0<=o?++a:--a)e=t.charCodeAt(n),this._isHiragana(e)?i+=String.fromCharCode(e+96):i+=t.charAt(n);return i}return t},t}(),e.AutoKana=t}).call(this);